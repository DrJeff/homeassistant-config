################################################################
## Packages / Blue Iris
################################################################

################################################
## Customize
################################################

homeassistant:
  customize:
    packages.blueiris: &customize
      haaska_hidden: true
      homebridge_hidden: true
      package: 'blueiris'

    automation.notify_driveway_motion:
      <<: *customize
      friendly_name: "Driveway Motion Notification"

    binary_sensor.amcrest_ptz_cam_motion:
      <<: *customize
      friendly_name: "Amcrest Ptz Cam Motion"
      device_class: motion

    binary_sensor.backyard_cam_motion:
      <<: *customize
      friendly_name: "Backyard Cam Motion"
      device_class: motion

    binary_sensor.driveway_cam_motion:
      <<: *customize
      friendly_name: "Driveway Cam Motion"
      device_class: motion

    binary_sensor.front_yard_cam_motion:
      <<: *customize
      friendly_name: "Front Yard Cam Motion"
      device_class: motion

    binary_sensor.garage_cam_motion:
      <<: *customize
      friendly_name: "Garage Cam Motion"
      device_class: motion

    binary_sensor.kitchen_cam_motion:
      <<: *customize
      friendly_name: "Kitchen Cam Motion"
      device_class: motion

    binary_sensor.living_room_cam_motion:
      <<: *customize
      friendly_name: "Living Room Cam Motion"
      device_class: motion

    binary_sensor.living_room_fd_cam_motion:
      <<: *customize
      friendly_name: "Front Door Cam Motion"
      device_class: motion

    binary_sensor.master_bedroom_cam_motion:
      <<: *customize
      friendly_name: "Master Bedroom Cam Motion"
      device_class: motion

    binary_sensor.parker_bedroom_cam_motion:
      <<: *customize
      friendly_name: "Parker Bedroom Cam Motion"
      device_class: motion

    camera.amcrest_ptz:
      <<: *customize
      friendly_name: "Amcrest PTZ"

    camera.backyard:
      <<: *customize
      friendly_name: "Backyard"

    camera.driveway:
      <<: *customize
      friendly_name: "Driveway"

    camera.front_yard:
      <<: *customize
      friendly_name: "Front Yard"

    camera.garage:
      <<: *customize
      friendly_name: "Garage"

    camera.kitchen:
      <<: *customize
      friendly_name: "Kitchen"

    camera.living_room:
      <<: *customize
      friendly_name: "Living Room"

    camera.master_bedroom:
      <<: *customize
      friendly_name: "Master Bedroom"

    camera.parker_bedroom:
      <<: *customize
      friendly_name: "Parker Bedroom"

    group.cameras_indoor:
      <<: *customize
      friendly_name: "Indoor Cameras"

    group.cameras_outdoor:
      <<: *customize
      friendly_name: "Outdoor Cameras"

################################################
## Group
################################################

group:
  cameras_indoor:
    control: hidden
    entities:
      - camera.amcrest_ptz
      - camera.backyard
      - camera.front_yard
      - camera.garage
      - camera.kitchen
      - camera.living_room
      - camera.master_bedroom
      - camera.parker_bedroom

  cameras_outdoor:
    control: hidden
    entities:
      - camera.driveway

################################################
## Automation
################################################

automation:
  - alias: notify_driveway_motion
    initial_state: 'off'
    trigger:
      - platform: state
        entity_id: binary_sensor.driveway_cam_motion
    action:
      - service: script.light_control
        data_template:
          entity_id: !secret light_gateway_light
          state: "{{ trigger.to_state.state }}"
          brightness: >-
            {{ 255 if 'H' in states.binary_sensor.driveway_cam_motion.attributes.type else 3 }}
          color_name: >-
            {{ 'red' if 'H' in states.binary_sensor.driveway_cam_motion.attributes.type else 'green' }}
      - service: script.xiaomi_ringtone
        data_template:
          ringtone: >-
            {% if trigger.to_state.state == 'on' and 'H' in states.binary_sensor.driveway_cam_motion.attributes.type %}
              7
            {% else %}
              10000
            {% endif %}

################################################
## Camera
################################################

camera:
  - platform: mjpeg
    name: amcrest_ptz
    mjpeg_url: !secret blueiris_amcrest_ptz_url
    username: !secret blueiris_username
    password: !secret blueiris_password
    authentication: basic

  - platform: mjpeg
    name: backyard
    mjpeg_url: !secret blueiris_backyard_url
    username: !secret blueiris_username
    password: !secret blueiris_password
    authentication: basic

  - platform: mjpeg
    name: driveway
    mjpeg_url: !secret blueiris_driveway_url
    username: !secret blueiris_username
    password: !secret blueiris_password
    authentication: basic

  - platform: mjpeg
    name: front_yard
    mjpeg_url: !secret blueiris_front_yard_url
    username: !secret blueiris_username
    password: !secret blueiris_password
    authentication: basic

  - platform: mjpeg
    name: garage
    mjpeg_url: !secret blueiris_garage_url
    username: !secret blueiris_username
    password: !secret blueiris_password
    authentication: basic

  - platform: mjpeg
    name: kitchen
    mjpeg_url: !secret blueiris_kitchen_url
    username: !secret blueiris_username
    password: !secret blueiris_password
    authentication: basic

  - platform: mjpeg
    name: living_room
    mjpeg_url: !secret blueiris_living_room_url
    username: !secret blueiris_username
    password: !secret blueiris_password
    authentication: basic

  - platform: mjpeg
    name: master_bedroom
    mjpeg_url: !secret blueiris_master_bedroom_url
    username: !secret blueiris_username
    password: !secret blueiris_password
    authentication: basic

  - platform: mjpeg
    name: parker_bedroom
    mjpeg_url: !secret blueiris_parker_bedroom_url
    username: !secret blueiris_username
    password: !secret blueiris_password
    authentication: basic
